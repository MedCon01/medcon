<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Siguiente paciente</title>
    <!--<link rel="stylesheet" type="text/css" href="../../static/css/siguiente_paciente.css">-->
    <link rel="stylesheet" type="text/css" th:href="@{/css/siguiente_paciente.css}" />

    <script>
		function mostrarHoraActual() {
		var fecha = new Date();
		var horas = fecha.getHours().toString().padStart(2, "0");
		var minutos = fecha.getMinutes().toString().padStart(2, "0");
		var tiempo = horas + ":" + minutos;
		document.getElementById("reloj").innerText = tiempo;
		}
        window.onload = function() {
            mostrarHoraActual(); // Mostrar la hora actual al cargar la página
            setInterval(mostrarHoraActual, 1000); // Actualizar la hora cada segundo
        };

    </script>
</head>
<body onload="iniciarCronometro()">
    <div id="barra">
        <p id="reloj">00:00:00</p>
    </div>

    <div class="info_paciente">
        <div class="foto">
        <img th:src="@{/images/avatar.png}" alt="logo_Medcon">
        <!--<img src="../../static/images/avatar.png" alt="logo_Medcon">-->
        </div>
        <div class="nombre">
            <h2>Antonio García Iglesias</h2>
        </div>
        <div class="nacimiento">
            <h2>13/09/1984</h2>
        </div>
        <div class="logo">
        <img th:src="@{/images/logo_Medcon.png}" alt="logo_Medcon">
        <!--<img src="../../static/images/logo_Medcon.png" alt="logo_Medcon">-->
        </div>
    </div>

    <div class="marco_dcha">
        <button id="historial" onclick="window.location.href = '/historial'">Historial médico</button>
        <button id="receta" onclick="window.location.href = '/receta'">Receta electrónica</button>
        <button id="pruebas" onclick="window.location.href = '/pruebas_medicas'">Pruebas médicas</button>
        <button id="gestion_citas" onclick="window.location.href = '/gestion_citas'">Gestión de citas</button>
        <button id="suspender_consulta" onclick="window.location.href = '/suspender_consulta'">Suspender consulta en curso</button>
        <button id="finalizar" onclick="window.location.href = '/finalizar_consulta'">Finalizar consulta</button>
        <div class="tiempo">
            <span id="timer">00:00:00</span>
        </div>
    </div>

    <script>        
        var segundos = 0;
        var minutos = 0;
        var horas = 0;
        var tiempoConsulta = document.getElementById("tiempoConsulta").textContent;
        var tiempoMedio = document.getElementById("timer-medio");
        tiempoMedio.textContent = tiempoConsulta;

        function iniciarCronometro() {
            // Obtener el tiempo transcurrido previamente almacenado en sessionStorage
            var tiempoTranscurrido = sessionStorage.getItem("tiempoTranscurrido");
            if (tiempoTranscurrido !== null) {
                var tiempoArr = tiempoTranscurrido.split(":");
                horas = parseInt(tiempoArr[0]);
                minutos = parseInt(tiempoArr[1]);
                segundos = parseInt(tiempoArr[2]);
            }

            // Obtener el tiempo transcurrido previamente almacenado en sessionStorage de la página de paciente
            var tiempoTranscurridoPaciente = sessionStorage.getItem("tiempoTranscurridoPaciente");
            if (tiempoTranscurridoPaciente !== null) {
                var tiempoArrPaciente = tiempoTranscurridoPaciente.split(":");
                var horasPaciente = parseInt(tiempoArrPaciente[0]);
                var minutosPaciente = parseInt(tiempoArrPaciente[1]);
                var segundosPaciente = parseInt(tiempoArrPaciente[2]);
                
                // Sumar el tiempo del paciente al tiempo previo del doctor
                horas += horasPaciente;
                minutos += minutosPaciente;
                segundos += segundosPaciente;
            }

            // Iniciar el cronómetro
            setInterval(actualizarTimer, 1000);
        }

        function actualizarTimer() {
            segundos++;
            if (segundos == 60) {
                segundos = 0;
                minutos++;
            }
            if (minutos == 60) {
                minutos = 0;
                horas++;
            }
            var segStr = segundos.toString().padStart(2, "0");
            var minStr = minutos.toString().padStart(2, "0");
            var hStr = horas.toString().padStart(2, "0");
            document.getElementById("timer").innerHTML = hStr + ":" + minStr + ":" + segStr;
        }

        function siguientePaciente() {
            // Almacenar el tiempo transcurrido en sessionStorage
            sessionStorage.setItem("tiempoTranscurrido", document.getElementById("timer").innerHTML);
            // Redirigir a la página de siguiente paciente
            window.location.href = "/siguiente_paciente";
        }

        function terminarConsulta() {
            // Redirigir a la página de paciente
            window.location.href = "/login_medico";
        }
    </script>
          
</body>
</html>

